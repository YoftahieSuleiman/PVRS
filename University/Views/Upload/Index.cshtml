@model IEnumerable<University.Models.UploadedDocument>
@{

    ViewBag.Title = "ECX";
}
<style type="text/css">
    h1 {
        font-size: 26px;
        font-weight: bold;
    }

    .unauthorized {
        animation: unauthorized 3s linear infinite;
        font-size: larger;
        color: indianred;
    }

    @@keyframes unauthorized {
        50% {
            opacity: 0;
        }
    }

    a:visited {
        color: #0254EB;
    }

    a.morelink {
        text-decoration: none;
        outline: none;
    }

    .morecontent span {
        display: none;
    }

    .comment {
        width: 400px;
        background-color: #f0f0f0;
        margin: 10px;
    }
</style>

<div style="color:red">
    @{
        if (TempData["ErrorMEssage"] != null)
        {
            Write(TempData["ErrorMEssage"]);
        }
    }
</div>
<br /><br />
<div class="row" style="width:100%;vertical-align:top" align="left">

    @{if (Session["UserGroup"].ToString() == "3")
    {
        string req = TempData["requestid"].ToString();
        <a href="#" onclick='UploadDocument("@(req)")' class="linkEffect" style="width:200px">Upload Document</a>
        <br /><br />
    }
    }
    
    <div id="datatable-buttons_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer" style="overflow: auto; width: 100%; padding: 5px; color: #000; height: 650px; ">
        <div id="datatable-buttons_filter" class="dataTables_filter"></div>
        Documents uploaded for valuation request by @(TempData["branch"]) for @(TempData["applicant"]) on @(TempData["date"]) 
        <table id="datatable-buttons" class="table table-striped table-bordered dataTable no-footer dtr-inline" role="grid" aria-describedby="datatable-buttons_info" style="width: 100%;color:#000;background-color:white">
            <thead>
                <tr role="row">
                    <th rowspan="1" class="sorting_asc" tabindex="0" aria-controls="datatable-buttons" colspan="1" style="width: 161px;" aria-sort="ascending" aria-label="LC NO.: activate to sort column descending">
                         Type
                    </th>
                    <th rowspan="1" class="sorting_asc" tabindex="0" aria-controls="datatable-buttons" colspan="1" style="width: 161px;" aria-sort="ascending" aria-label="LC NO.: activate to sort column descending">
                        
                    </th>
                    <th>

                    </th>
                </tr>
            </thead>
            <tbody>
                @{ int x = 0;}
                @foreach (var item in Model)
                {

                    x++;

                    if (x % 2 != 0)
                    {

                        @Html.Raw("<tr class='odd' role='row'>");
                    }
                    else
                    {
                        @Html.Raw("<tr class='even' role='row'>")
                    }
                <td>
                    @(item.luDocumentType.Name + (item.DocumentTypeId == 6 ? ("--" + item.Remark) : ""))
                </td>
                    <td>
                        <a href='@("../"+item.FilePath)' target="_blank">View</a>
                    </td>
                    

                    <td>
                      
                        @{

                    if ((item.EstimationRequest.Status <= 2) && Session["UserGroup"] != null && Session["UserGroup"].ToString() == "3")
                    {
                        <a href="#" onclick='ChangeDocument("@(item.Id)")' class="linkEffect" style="width:200px">Change</a>
                        <a href="#" onclick='RemoveDocument("@(item.Id)")' class="linkEffect" style="width:200px">Remove</a>

                    }
}
                    </td>

                    @Html.Raw("</tr>");
                }
                </tbody>
            </table>
        </div>



        <div class="modal fade" id="photoEditor" style="height:600px;z-index:100000">
            <div class="modal-dialog" style="height:600px">
                <div class="modal-content" style="height:600px">
                    <div class="modal-header" id="myBodyBG2" style="height:50px">
                        <div style="width:100%" align="right"><table><tr><td><h1></h1></td><td>&nbsp;&nbsp;&nbsp;</td><td><h1><a href="#" class="close" style="color:#fff" onclick="javascript:closeModal()">x</a></h1></td></tr></table></div>
                        <h3 class="modal-title" id="modaltitle" style="text-align:center;color:#cd5c5c;top:15px;left:200px;position:absolute"></h3>
                    </div>
                    <div class="modal-body" id="modalbodydiv" style="height:500px;overflow:auto;width:100%">

                    </div>
                    <div class="modal-footer">

                    </div>

                </div>
            </div>
        </div>
    <div class="modal fade" id="photoEditor2" style="height:600px;z-index:200000">
        <div class="modal-dialog" style="height:600px">
            <div class="modal-content" style="height:600px">
                <div class="modal-header" id="myBodyBG2" style="height:50px">
                    <div style="width:100%" align="right"><table><tr><td><h1></h1></td><td>&nbsp;&nbsp;&nbsp;</td><td><h1><a href="#" class="close" style="color:#fff" onclick="javascript:closeModal()">x</a></h1></td></tr></table></div>
                    <h3 class="modal-title" id="modaltitle" style="text-align:center;color:#cd5c5c;top:15px;left:200px;position:absolute"></h3>
                </div>
                <div class="modal-body" id="modalbodydiv2" style="height:500px;overflow:auto;width:100%">

                </div>
                <div class="modal-footer">

                </div>

            </div>
        </div>
    </div>








    </div>
    @{
        if (Session["BranchName"] != null && Session["BranchName"].ToString() != "")
        {
            // WriteLiteral("<script>var branch=" + Session["BranchName"].ToString() + ";</script>");
        }
    }
    <script type="text/javascript">

    $(document).ready(function () {

        var showChar = 300;
        var ellipsestext = "...";
        var moretext = "more";
        var lesstext = "less";
        $('.more').each(function () {
            var content = $(this).html();

            if (content.length > showChar) {

                var c = content.substr(0, showChar);
                var h = content.substr(showChar, content.length - showChar);

                var html = c + '<span class="moreellipses">' + ellipsestext + '&nbsp;</span><span class="morecontent"><span>' + h + '</span>&nbsp;&nbsp;<a href="" class="morelink">' + moretext + '</a></span>';

                $(this).html(html);
            }

        });

        $(".morelink").click(function () {
            if ($(this).hasClass("less")) {
                $(this).removeClass("less");
                $(this).html(moretext);
            } else {
                $(this).addClass("less");
                $(this).html(lesstext);
            }
            $(this).parent().prev().toggle();
            $(this).prev().toggle();
            return false;
        });




    });
    //var userid=@(Session["UserID"].ToString());
    var UploadDocument = function (id) {
        $("#modaltitle").text("Upload Document");
        var url = "";
       url = "../Upload?id=" + id;


        $("#modalbodydiv").load(url, function () {
            $("#photoEditor").modal("show");
        })


    }
    var ChangeDocument = function (docid) {
        $("#modaltitle").text("Change Document");
        var url = "";
        url = "../ChangeDoc?reqid=" + @(TempData["requestid"].ToString())+"&docid="+docid;


        $("#modalbodydiv").load(url, function () {
            $("#photoEditor").modal("show");
        })


    }
        var RemoveDocument = function (docid) {
            $("#modaltitle").text("Remove Document");
            var url = "";
            url = "../RemoveDoc?reqid=" + @(TempData["requestid"].ToString())+"&docid="+docid;


            $("#modalbodydiv").load(url, function () {
                $("#photoEditor").modal("show");
            })


        }
    var ShowDetail = function (id) {




        $("#modaltitle").text("Request Valuation Detail");
        var url = "";
        url = "../Upload/ValuationRequestDetail/"+id;

        $("#modalbodydiv").load(url, function () {
            $("#photoEditor").modal("show");
        })


    }

    var closeModal = function () {
        if (confirm("Are you sure you want to close this form? Click cancel if you want to stay and save your work")) {
            document.getElementById("modalbodydiv").innerHTML = "";
            $("#photoEditor").modal("hide");
        }
    }
    </script>
